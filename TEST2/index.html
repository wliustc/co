<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>快乐消费轻松交易，邮政送好礼</title>
    <link href="//i2.beta.ulecdn.com/i/favicon.ico" rel="icon" type="image/x-icon" />
    <link href="//i2.beta.ulecdn.com/i/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    <link href="//i2.beta.ulecdn.com/i/favicon.ico" rel="bookmark" type="image/x-icon" />
    <link rel="stylesheet" href="//i0.beta.ulecdn.com/c/event/2017/0612/postJiangsuAct/style.css?v=1">
</head>

<body>
    <div class="wrapper">
        <section class="banner">
            <img src="//i0.beta.ulecdn.com/i/event/2017/0612/postJiangsuAct/banner_01.jpg" width="100%">
            <img src="//i0.beta.ulecdn.com/i/event/2017/0612/postJiangsuAct/banner_02.jpg" width="100%">
            <img src="//i0.beta.ulecdn.com/i/event/2017/0612/postJiangsuAct/banner_03.jpg" width="100%">
        </section>

        <section class="login">
            <form id="loginForm" class="form">
                <div class="leftBox">
                    <label><input id="cardNo" type="text" placeholder="请输入您的身份证号后六位"></label>
                    <label><input id="phoneNo" type="number" placeholder="请输入您的预留手机号"></label>
                </div>
                <div class="rightBox">
                    <p class="submitBtn">提交验证信息</p>
                </div>
            </form>
            <div class="loginStatus">
                <p>您当前的状态是<span class="isLogin">未登录</span></p>
                <p>*您可在活动开始前完成<span class="toLogin">注册/登录</span>抢兑快人一步。</p>
            </div>
            <div class="mask">本月礼品已经领完，感谢您的关注！</div>
        </section>

        <section class="couponBox rel">
            <div class="bgWrapper">
                <img class="hide" src="//i0.beta.ulecdn.com/i/event/2017/0612/postJiangsuAct/couponBox_00.jpg" width="100%">
                <img src="//i0.beta.ulecdn.com/i/event/2017/0612/postJiangsuAct/couponBox_01.jpg" width="100%">
                <img src="//i0.beta.ulecdn.com/i/event/2017/0612/postJiangsuAct/couponBox_02.jpg" width="100%">
                <img src="//i0.beta.ulecdn.com/i/event/2017/0612/postJiangsuAct/couponBox_03.jpg" width="100%">
            </div>
            <div class="couponWrapper abs">
                <ul class="couponUl">
                    <li data-id="first"><img src="//i0.beta.ulecdn.com/i/event/2017/0612/postJiangsuAct/coupon_01.jpg" width="100%"></li>
                    <li data-id="second"><img src="//i0.beta.ulecdn.com/i/event/2017/0612/postJiangsuAct/coupon_02.jpg" width="100%"></li>
                </ul>
            </div>
            <div class="mask">本月您已领取过礼品，<br> 话费充值和“邮乐江苏”通用券仅限二选一，感谢您的关注。
                <br> 如未收到充值或优惠券，请致电4008011185！
            </div>
        </section>

        <section class="newUserCoupon">
            <h3 class="title">邮乐新注册用户优惠券</h3>
            <div class="content clearfix">
                参与本活动的邮乐网新注册用户（6月1日－11月30日期间注册），可在领取以上任一领取的基础上再领取新人券礼包，活动期间每用户限领一次，包含<span class="txtYellow">58-8元、98-8元、188-18元</span>满减券各一张邮乐网全网通，8元运费券两张。<a class="toReceiveBtn fr">点击领取>></a>
            </div>
        </section>

        <section class="activityRule">
            <h3 class="moduleTitle">活动规则</h3>
            <ul class="content">
                <li>1、活动时间：2017年6月1日-2017年10月31日。</li>
                <li>2、活动对象：江苏邮政企业所有加办电子银行的绿卡客户。</li>
                <li>3、参与条件：活动期间，满足以下任一条件，可抢兑价值20元话费或“邮乐江苏”现金券一份。①使用邮储绿卡进行POS消费达3笔、且每笔交易金额不低于100元。②通过邮储个人网银、手机银行进行账务类交易达3笔、且交易金额累计达100元。个人网银、手机银行账务类交易包括转账、缴费充值、申购理财产品、购买电影票等。</li>
                <li>4、参与流程：当月满足兑奖条件后，次月25日10点起，登录“江苏邮政金融”微信公众号“优惠活动——交易有礼”专区，输入预留手机号码，通过系统验证符合条件后，即可抢兑礼品，每个客户及邮乐用户当月限领1份礼品，数量有限，先到先得。当月取得获奖资格不影响次月继续获奖。</li>
                <li>5、话费充值将于1个工作日内充值到预留手机号，“邮乐江苏”现金券领取后立即发放到参与活动的邮乐账户，使用范围为“邮乐江苏”商城（网址：js.ule.com）商品购物，可在“我的邮乐”-“优惠券”查看使用规则，须在有效期内使用，逾期失效，不予补发。</li>
                <li>6、具备活动资格的邮乐网新注册用户，可在领取当月好礼的基础上，再领取新人券礼包，活动期间限领一次。新人券礼包为多张券组合，领取后立即发放到用户参与活动的邮乐账户，可在“我的邮乐”-“优惠券”查看使用规则，须在有效期内使用，逾期失效，不予补发。</li>
                <li>7、使用非正常手段参与活动，主办方有权拒绝发放或追回礼品，并追究相关人员责任。</li>
                <li>8、客服电话：4008011185。</li>
            </ul>
        </section>

        <section class="goodsList">
            <h3 class="moduleTitle rel">特惠商品<span class="moregoods small-font">更多商品前往邮乐江苏>></span></h3>
            <ul class="ul-style clearfix"></ul>
        </section>

    </div>
    <div class="loading">
        <img src="//i0.beta.ulecdn.com/i/event/2017/0612/postJiangsuAct/loading.gif" width="">
    </div>
    <script src="//i0.ulecdn.com/ulewap/j/common/zepto.min.js"></script>
    <script src="//i0.beta.ulecdn.com/j/app/event/2017/0612/postJiangsuAct/zepto.lazyload.min.js"></script>
    <script>
        $(function() {
            var uleUrl = location.host.substring(location.host.indexOf('.') + 1);
            var url = location.href;

            //定义跳转到shop页面
            var shopUrl = '//m.ule.com/item/detail/';

            // 扩展String 原型
            $.extend(String.prototype, {
                //method
                trimAll: function() {
                    return this.replace(/\s/g, '');
                },
                format: function() {
                    var result = this;
                    if (arguments.length > 0) {
                        var parameters = (arguments.length == 1 && $.isArray(arguments[0])) ? arguments[0] : $.makeArray(arguments);
                        $.each(parameters, function(i, n) {
                            result = result.replace(new RegExp("\\{" + i + "\\}", "g"), n);
                        });
                    }
                    return result;
                },
                sliceAfter: function(str) {
                    return (this.indexOf(str) >= 0) ? this.substring(this.indexOf(str) + str.length, this.length) : '';
                },
                sliceBefore: function(str) {
                    return (this.indexOf(str) >= 0) ? this.substring(0, this.indexOf(str)) : '';
                },
                isMobile: function() {
                    return new RegExp(/^(13|14|15|17|18)\d{9}$/).test(this);
                },
                isCardNo: function() {
                    // 验证省份证号后6位
                    return new RegExp(/(^\d{6}$)|(^\d{5}(\d|X|x)$)/).test(this);
                }
            });
            // 浏览器环境判断
            $.browser = $.browser || {};
            $.extend($.browser, (function() {
                var ua = navigator.userAgent.toLowerCase(),
                    os, version;
                if (ua.indexOf('uleapp/') > 0) {
                    version = ua.sliceAfter('uleapp/').split('_')[3];
                    os = ua.sliceAfter('uleapp/').sliceBefore('_');
                    if (ua.sliceAfter('uleapp/').split('_')[1] == 'ule') {
                        var uappType = {
                            ule: true,
                            ylxd: false
                        };
                    } else {
                        var uappType = {
                            ule: false,
                            ylxd: true
                        };
                    }
                    var appobj = $.extend({
                        ios: os == 'ios',
                        android: os == 'android',
                        version: version
                    }, uappType);
                    return appobj;
                } else if (ua.indexOf('uzgapp/') > 0) {
                    version = ua.sliceAfter('uzgapp/').split('_')[3];
                    os = ua.sliceAfter('uzgapp/').sliceBefore('_');
                    return {
                        uzg: true,
                        wx: false,
                        ios: os == 'ios',
                        android: os == 'android',
                        version: version
                    };
                } else {
                    return {
                        ule: false,
                        uzg: false,
                        ylxd: false,
                        wx: ua.match(/micromessenger/i),
                        ios: ua.match(/(iphone|ipod|ipad);?/i),
                        android: ua.match(/android/i)
                    };
                }
            })());

            // ajax 数据请求可通用
            var Ajax = {
                needLoading: false,
                execute: function(o) {
                    var success = o.success ? o.success : function() {};
                    var complete = o.complete ? o.complete : function() {};
                    var data = o.data ? o.data : {};
                    var asy = o.asy ? false : true;
                    $.ajax({
                        type: 'GET',
                        url: o.url,
                        cache: false,
                        async: asy,
                        beforeSend: function() {
                            if (o.loading === true) {
                                $('.loading').show();
                            } else if (o.loading === false) {

                            } else {
                                Ajax.needLoading = true;
                                setTimeout(Ajax.delayLoading, 500);
                            }
                        },
                        data: data,
                        dataType: 'jsonp',
                        jsonp: 'callback',
                        success: function(data) {
                            success(data);
                        },
                        error: this.errorHandler,
                        complete: function() {
                            Ajax.needLoading = false;
                            $('.loading').hide();
                            complete();
                        }
                    });
                },
                errorHandler: function(data) {
                    var errorCodes = {
                        2: '接收到了错误的数据类型。',
                        4: '您访问的页面不存在。',
                        5: '系统发生了故障，请再试一次。'
                    };
                    var errorMessage = '网络不通畅。';
                    var status = data.status.toString().charAt(0);
                    if (errorCodes[status]) {
                        errorMessage = errorCodes[status];
                    }
                    if (errorMessage) {
                        alert(errorMessage);
                    }
                },
                delayLoading: function() {
                    if (Ajax.needLoading) {
                        $('.loading').show();
                    }
                }
            };

            // 本地存储 LocalStorage
            var storage = {
                get: function(key) {
                    return JSON.parse(localStorage.getItem(key));
                },
                set: function(key, value) {
                    localStorage.setItem(key, JSON.stringify(value));
                },
                del: function(key) {
                    localStorage.removeItem(key);
                }
            }

            // 信息提示弹窗
            var tipBox = (function() {
                var tipItem, innerItem;
                return function(options) {
                    options = $.extend({
                        status: '',
                        type: 0,
                        title: '出错啦!',
                        msg: []
                    }, options);
                    if (!tipItem) {
                        tipItem = $('<div class="tipBox"><div class="tipWrapper"></div></div>');
                        tipItem.appendTo('body');
                    }
                    tipItem.find('.tipWrapper').addClass(options.status);
                    if (options.status == 'couponReceive') {
                        innerItem = '<div class="top"></div><div class="content"></div><div class="toReceive center"></div><div class="close"></div>';
                        var giftsImgArr = ['success_01.png', 'coupon_04.png', 'coupon_03.jpg']
                        var topImg = '<img src="//i0.beta.ulecdn.com/i/event/2017/0612/postJiangsuAct/' + giftsImgArr[options.type] + '" width="80%">';
                        var tipName = '<p class="tipName center">' + options.title + '</p>';
                        var toView = options.toView ? '<p class="toView center"><a href="###">查看优惠券>></a></p>' : '';
                        var toReceive = options.toReceive ? '<span>立即去用券>></span>' : '';
                        var tipDesc = '';
                        for (var i = 0; i < options.msg.length; i++) {
                            tipDesc += '<p class="tipDesc">' + options.msg[i] + '</p>'
                        }
                        tipItem.find('.tipWrapper').html(innerItem);
                        tipItem.find('.top').html(topImg);
                        tipItem.find('.content').html(tipName + tipDesc + toView);
                        tipItem.find('.toReceive').html(toReceive);
                    } else {
                        innerItem = '<div class="tipCloseBtn"></div><ul class="tipInner"><li class="tipStatusImg"></li><li class="tipContent"></li></ul>';
                        var tipStatusImg = options.status === 'success' ? '' : '<img src="//i0.beta.ulecdn.com/i/event/2017/0612/postJiangsuAct/error.png" width="100%">';
                        var toReceiveGift = options.toReceiveGift ? '<p class="toReceiveGift">' + options.toReceiveGift + '</p>' : '';
                        var toView = options.toView ? '<p class="toView"><a href="###">查看优惠券>></a></p>' : '';
                        var tipName = '<p class="tipName">' + options.title + '</p>';
                        var tipDesc = '';
                        for (var i = 0; i < options.msg.length; i++) {
                            tipDesc += '<p class="tipDesc">' + options.msg[i] + '</p>'
                        }
                        tipItem.find('.tipWrapper').html(innerItem);
                        tipItem.find('.tipName').html(options.title);
                        tipItem.find('.tipContent').html(tipName + tipDesc + toReceiveGift + toView);
                        tipItem.find('.tipStatusImg').html(tipStatusImg);
                    }
                    tipItem.show();
                    $('.tipCloseBtn, .toReceiveGift, .close').click(function() {
                        tipItem.hide();
                        tipItem.find('.tipWrapper').removeClass(options.status);
                    });
                    var callback = options.callback;
                    (callback && typeof(callback) === 'function') && callback();
                }
            }());


            var postJiangsuAct = {
                keys: ['event_20170613_zk'],
                api: {
                    getPrdsUrl: '//search.ule.com/api/recommend?jsoncallback=?&restype=2001' // 商品
                        ,
                    queryQualification: '//prize.' + uleUrl + '/mc/jiangSuGreenCard/whiteListLogin' // 资格验证
                        ,
                    receivePrize: '//prize.' + uleUrl + '/mc/jiangSuGreenCard/receivePrize' // 充值领券
                        ,
                    newsCoupon: '//prize.' + uleUrl + '/mc/jiangSuGreenCard/newsReceiveCoupon' // 新人领券
                },
                init: function() {
                    var m = this;
                    // 检查登录状态
                    m.isLogin(function() {
                        $('.isLogin').text('已登录');
                        $('.toLogin').click(function() {
                            m.userLogin();
                        })
                        m.bindEvent()
                    });
                },
                trimAll: function(str) {
                    return str.replace(/\s/g, '');
                },
                sprintf: function() {
                    var str = arguments[0] || '';
                    for (var i = 1, len = arguments.length; i < len; i++) {
                        str = str.replace(/%s/, arguments[i]);
                    }
                    return str;
                },
                getUrl: function() {
                    if ($.browser.ule) {
                        shopUrl = 'uleMobile://uleVi_';
                    } else if ($.browser.ylxd) {
                        shopUrl = '//m.ule.com/item/ylxd/detail/';
                    }
                },
                getCookie: function(name) {
                    var cookies = document.cookie.split(";");
                    for (var i = 0, len = cookies.length; i < len; i++) {
                        if (cookies[i].split('=')[0].trim() == name) {
                            return cookies[i].split('=')[1];
                        }
                    }
                },
                checkUserStatus: function() {
                    if (this.getCookie('mall_cookie')) {
                        return true;
                    } else {
                        return false;
                    }
                },
                isLogin: function(callback) {
                    var m = this;
                    if (m.checkUserStatus()) {
                        callback && callback.apply(this);
                    } else {
                        //末登录
                        $('.toLogin, .submitBtn, .couponUl').click(function() {
                            m.userLogin();
                        })
                    }
                },
                userLogin: function(callback) {
                    var m = this;
                    if ($.browser.ule) {
                        //邮乐app
                        location.href = 'uleMobile://uleLogin_' + url;
                    } else {
                        if (m.getCookie('client_type') == 'wx_psbc') {
                            //邮储
                            location.href = 'https://m.' + uleUrl + '/user/relation?target=' + encodeURIComponent(location.href);
                        } else {
                            //邮乐
                            location.href = 'https://m.' + uleUrl + '/user/login?target=' + url;
                        }
                    }
                },
                bindEvent: function() {
                    var m = this;
                    // 提交按钮
                    $('.submitBtn').click(function() {
                        // 本地存储用户输入信息
                        var data = {
                            idNumber: $('#cardNo').val(),
                            mobile: $('#phoneNo').val()
                        };
                        storage.set('userInput', data);
                        //console.log(data)
                        // 本地输入信息验证
                        var validateForm = {
                            validateIdNumber: function() {
                                return data.idNumber.trimAll() !== "" && data.idNumber.isCardNo();
                            },
                            validateMobile: function() {
                                return data.idNumber.trimAll() !== "" && data.mobile.isMobile()
                            }
                        };
                        for (var i in validateForm) {
                            if (!validateForm[i]()) {
                                tipBox({
                                    status: 'error',
                                    title: '验证失败!',
                                    msg: ['抱歉,您输入的信息不符合格式!', '请重新输入!']
                                });
                                return;
                            }
                        }
                        // 服务端验证
                        Ajax.execute({
                            url: m.api.queryQualification,
                            data: data,
                            success: function(res) {
                                res.code = '0001';
                                res.content = {}; //res.content.coupon = true;
                                console.log(res);
                                if (res.code === '0001') {
                                    tipBox({
                                        status: 'success',
                                        title: '验证成功!',
                                        toReceiveGift: '请立刻去领礼品>>',
                                        callback: function() {
                                            // 点击切换到领取兑换页
                                            $('.toReceiveGift').click(function() {
                                                $('.login').hide();
                                                $('.couponBox .bgWrapper>img').eq(0).show();
                                                $('.couponBox .bgWrapper>img').eq(1).hide();
                                                $('.goodsList').show();
                                                // 获取商品
                                                m.getList(m.keys[0]);
                                                // 已领取过话费或券
                                                if (res.content.recharge || res.content.coupon) {
                                                    $('.couponBox .mask').show();
                                                    return;
                                                }
                                                // 用户领券
                                                if (!res.content.coupon) {
                                                    m.receiveCoupon();
                                                }
                                                // 新注册用户领券
                                                res.content.newsCoupon = false;
                                                if (!res.content.newsCoupon) {
                                                    $('.toReceiveBtn').show();
                                                    $('.toReceiveBtn').click(function() {
                                                        m.newsCouponRecive();
                                                    })
                                                }
                                            })
                                        }
                                    });
                                } else if (res.code === '0002') {
                                    tipBox({
                                        status: 'error',
                                        title: '验证失败!',
                                        msg: ['抱歉,您不具备验证资格!', '请检查输入信息的正确性或请致电4008011185核实参与资格!']
                                    });
                                } else {
                                    tipBox({
                                        status: 'error',
                                        title: '验证失败!'
                                    });
                                }
                            }
                        })
                    });
                },
                receiveCoupon: function() {
                    var m = this;
                    $('.couponUl li').click(function() {
                        var id = $(this).data('id');
                        var data = {
                            activityCode: 'MA_U_149619622707130',
                            mobile: storage.get('userInput').mobile,
                            idNumber: storage.get('userInput').idNumber
                        };
                        Ajax.execute({
                            url: m.api.receivePrize,
                            data: data,
                            success: function(res) {
                                if (res.code === '0000') {
                                    if (id === 'first') {
                                        tipBox({
                                            status: 'couponReceive',
                                            type: 1,
                                            title: '您已领取成功!',
                                            msg: ['话费将充值到您的验证手机号，如有疑问请致电4008011185。']
                                        })
                                    }
                                    if (id === 'second') {
                                        tipBox({
                                            status: 'couponReceive',
                                            type: 2,
                                            title: '您已领取成功!',
                                            msg: ['优惠券已发放到您邮乐账户，请登录个人中心－我的优惠券查看。'],
                                            toView: true,
                                            toReceive: true
                                        });
                                    }
                                } else if (res.code === '1105') {
                                    tipBox({
                                        status: 'error',
                                        title: '领取失败!',
                                        msg: [
                                            '本月您已领取过礼品，话费充值和“邮乐江苏”通用券仅限二选一，感谢您的关注。',
                                            '如未收到充值或优惠券，请致电4008011185!'
                                        ]
                                    });
                                } else if (res.code === '8001') {
                                    tipBox({
                                        status: 'error',
                                        title: '活动已结束!',
                                        msg: ['本期活动名额已抢兑完毕，', '敬请下期参与。']
                                    })
                                } else {
                                    tipBox({
                                        status: 'error',
                                        title: '领取失败!',
                                        msg: ['姿势不对，请重新领取!']
                                    });
                                }
                            }
                        })
                    })
                },
                newsCouponRecive: function() {
                    var m = this;
                    var data = {
                        activityCode: 'MA_U_149619622707130',
                        mobile: storage.get('userInput').mobile,
                        idNumber: storage.get('userInput').idNumber
                    };
                    Ajax.execute({
                        url: m.api.newsCoupon,
                        data: data,
                        success: function(res) {
                            res.code = '1105';
                            console.log(res);
                            if (res.code === '0000') {
                                tipBox({
                                    status: 'couponReceive',
                                    type: 0,
                                    title: '您已领取成功!',
                                    msg: ['优惠券已发放到您的邮乐账户，请在有效期内根据优惠券规则使用，请登陆“我的邮乐”-“优惠券”查看优惠券使用规则。'],
                                    toView: true,
                                    toReceive: true
                                });
                            } else if (res.code === '1105') {
                                tipBox({
                                    status: 'error',
                                    title: '抱歉!',
                                    msg: ['您已领取过新人券，感谢您的关注!'],
                                    toReceiveGift: '立即去用券>>',
                                    toView: true
                                });
                            } else if (res.code === '1103') {
                                tipBox({
                                    status: 'error',
                                    title: '抱歉!',
                                    msg: ['您不是活动期间注册的', '邮乐新用户，不可领取。']
                                });
                            }
                        }
                    })
                },
                item: '<li><a href="%s">\
                        <div class="pic">\
                            <img class="img" data-original="%s" src="//i0.ulecdn.com/ulewap/i/290x290x2x.png"/>%s\
                        </div>\
                        <div class="desc">\
                            <div class="name">%s</div>\
                            <div class="price">\
                                <p class="leftBox">活动价:<span class="priceMin"><sup class="small-font">￥</sup>%s</span></p>\
                                <p class="rightBox %s"><span class="buyBtn">%s</span></p>\
                            </div>\
                        </div>\
                    </a></li>',
                // 商品推荐位
                getList: function(key) {
                    var m = this;
                    var data = {
                        moduleKeys: key,
                        times: new Date().getTime()
                    };
                    $.getJSON(m.api.getPrdsUrl, data, function(res) {
                        //console.log(res)
                        for (var k in res) {
                            var items = '';
                            var data = res[k];
                            for (var i = 0, len = data.length; i < len; i++) {
                                var value = data[i]; //value.inStock = 0;
                                var href = value.inStock ? shopUrl + value.listingId : 'javascript:void(0);';
                                var imgUrl = value.imgUrl.replace(/http:/, '');
                                var temp = value.inStock ? '' : '<div class="isover"></div>';
                                var btnDefault = value.inStock ? '' : 'btn-default';
                                var btnTxt = value.inStock ? '加入购物车' : '商品已售完';
                                items += m.sprintf(m.item,
                                    href,
                                    imgUrl,
                                    temp,
                                    value.listingName,
                                    value.minPrice,
                                    btnDefault,
                                    btnTxt);
                            }
                            $('.goodsList .ul-style').append(items);
                            $(".img").picLazyLoad({
                                effect: "fadeIn",
                                threshold: 420
                            });
                        }
                    })
                }
            };
            postJiangsuAct.init();

        });
    </script>
</body>

</html>